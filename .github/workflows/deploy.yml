name: deploy

on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
        type: choice
        options:
          - info
          - warning
          - debug
      print_envs:
        description: 'True to print to STDOUT'
        required: true
        default: true
        type: boolean
      deploy-to-dev:
        description: 'Deploy to dev'
        required: true
        default: true
        type: boolean
      deploy-to-tst:
        description: 'Deploy to tst'
        required: true
        default: true
        type: boolean
      deploy-to-prd:
        description: 'Deploy to prd'
        required: true
        default: true
        type: boolean
      # tags:
      #   description: 'Test scenario tags'
      #   required: true
      #   type: string
      environment:
        description: 'Environment to run tests against'
        type: environment
        required: true
      environments:
        description: 'Environments?'
        type: string
        default: '["dev", "prd"]'
        required: true

jobs:
  print-envs:
    strategy:
      max-parallel: 1
      matrix:
        environment: ${{ fromJson(inputs.environments) }}
    runs-on: ubuntu-latest
    if:  ${{ inputs.print_envs }} 
    steps:    
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - uses: ./.github/actions/deploy-to-env
        with:
          env: ${{ matrix.environment }}

  deploy-stuff:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Do something
        run: cat asdf.txt
    needs: [print-envs]